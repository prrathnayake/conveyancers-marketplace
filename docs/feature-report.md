# Feature Gap Assessment

This refreshed matrix reflects the current state of the codebase after validating the key flows.

## Detailed Matrix

| Category | Feature / Module | Status | Evidence & Gap Summary |
| --- | --- | --- | --- |
| Onboarding & Identity | Multi-Role Registration | Partial | The identity service provisions accounts and linked conveyancer profiles in memory, seeding sample firms at startup, but persistence relies on process-scoped maps so new registrations are lost on restart and there is no downstream verification hook.【F:backend/services/identity/main.cpp†L233-L321】【F:backend/services/identity/main.cpp†L1254-L1266】 |
| Onboarding & Identity | KYC Workflow | Partial | Identity checks call a sandbox `KycProviderSimulator` that hashes document numbers to a score; external providers, document storage, and rejection remediation are still stubs.【F:backend/services/identity/main.cpp†L164-L205】 |
| Onboarding & Identity | Two-Factor Authentication | Available | Challenge issuance and verification enforce five-minute windows, attempt limits, and mint session tokens once a valid TOTP code is supplied.【F:backend/services/identity/main.cpp†L518-L566】 |
| Conveyancer Profile Management | Directory Search & Restrictions | Available | The Next.js API queries SQLite-backed profiles, applies keyword/state filters, and suppresses restricted jurisdictions unless the viewer is an administrator.【F:frontend/pages/api/profiles/search.ts†L1-L118】 |
| Conveyancer Profile Management | Profile Detail & Compliance Badges | Available | Profile lookups enrich results with specialties, job history placeholders, and jurisdiction gating so restricted conveyancers stay hidden from public users.【F:frontend/pages/api/profiles/[id].ts†L1-L118】 |
| Communication & Document Exchange | Document Library & Versioning | Partial | Job endpoints attach encrypted document versions, track signature state, and expose signed URLs, yet everything lives inside the in-memory job store so uploads disappear between runs.【F:backend/services/jobs/main.cpp†L575-L667】【F:backend/services/jobs/main.cpp†L424-L505】 |
| Communication & Document Exchange | Contact Gating & Unlock Tokens | Partial | Payment holds mint scoped unlock tokens and the jobs service reveals contact details once admins validate them, but tokens never expire and enforcement depends on in-memory state.【F:backend/services/payments/main.cpp†L740-L782】【F:backend/services/jobs/main.cpp†L1159-L1795】 |
| Communication & Document Exchange | Voice & Video Session Scheduling | Available | Buyers, sellers, conveyancers, and admins can schedule voice/video sessions per job, generating join URLs and scoped access tokens while exposing audit-friendly listings.【F:backend/services/jobs/main.cpp†L775-L1853】 |
| Work Execution | Templates & Milestones | Partial | A reusable template library seeds jurisdiction-specific task bundles and jobs track milestones, yet definitions and job records are held in volatile maps without shared persistence.【F:backend/services/jobs/main.cpp†L360-L833】 |
| Payments & Escrow | Holds, Invoicing & Trust Payouts | Partial | The payments service models holds, invoices, loyalty metadata, and trust payouts, but every ledger is an in-memory map so no PSP integration or durable records exist yet.【F:backend/services/payments/main.cpp†L64-L358】【F:backend/services/payments/main.cpp†L348-L353】 |
| Payments & Escrow | Quote Notification Logging | Partial | Quote helpers manage lifecycle transitions and record notification attempts in SQLite, but there is no channel integration tying those records to outbound email/SMS delivery.【F:frontend/lib/quotes.ts†L1-L136】 |
| Admin & Analytics | Risk Insights Dashboard | Partial | Admin insights aggregate contact flags, IP correlations, and retention heuristics, yet the signals run purely on seeded demo jobs so production telemetry still needs wiring.【F:backend/services/jobs/main.cpp†L855-L934】【F:backend/services/jobs/main.cpp†L937-L1033】 |
| Security & Compliance | Privacy Consents & Erasure | Available | Privacy APIs capture consent, list outstanding erasure requests, and let admins approve or reject them with full audit logging.【F:backend/services/identity/main.cpp†L645-L780】【F:backend/services/identity/main.cpp†L1580-L1705】 |
| Operations & Alerts | Admin Change Notifications | Partial | Email/SMS helpers can alert admins about sensitive changes, but they silently short-circuit without SMTP/Twilio credentials so no notifications fire in most environments.【F:frontend/lib/notifications.ts†L16-L93】 |
| Observability | Metrics & Error Instrumentation | Available | Standard handlers attach structured logging and expose authenticated Prometheus metrics endpoints for every C++ service.【F:backend/common/security.h†L300-L338】 |

## Key Recommendations

1. Introduce durable storage (e.g., SQLite/Postgres adapters) for identity, jobs, and payments so registrations, documents, and financial records survive restarts and align with the Next.js data model.【F:backend/services/identity/main.cpp†L233-L321】【F:backend/services/identity/main.cpp†L1254-L1266】【F:backend/services/jobs/main.cpp†L424-L505】【F:backend/services/payments/main.cpp†L348-L353】
2. Replace simulator logic with real integrations—wire the KYC/licence workflow and payment hold release to external providers to deliver auditable compliance outcomes.【F:backend/services/identity/main.cpp†L164-L205】【F:backend/services/identity/main.cpp†L233-L267】【F:backend/services/payments/main.cpp†L740-L782】
3. Connect notification and workflow signals to delivery infrastructure so quote alerts, contact unlocks, and admin actions reach stakeholders instead of staying as local log entries.【F:frontend/lib/quotes.ts†L1-L136】【F:frontend/lib/notifications.ts†L16-L93】【F:backend/services/jobs/main.cpp†L1762-L1836】
